<launch>
  <!-- Static transforms: world -> left_camera / right_camera -->

  <!-- LEFT CAMERA: from your values -->
  <node pkg="tf2_ros" exec="static_transform_publisher"
        args="-0.014676985486388058 -0.0047754858005039985 0.6855668802615765 0.685407046315142 -0.7144977747493646 -0.1043397098820987 0.09393261244891858 world left_camera"/>

  <!-- RIGHT CAMERA: from your values -->
  <node pkg="tf2_ros" exec="static_transform_publisher"
        args="0.033871834234873985 -0.014851401895387344 0.703589542822821 -0.6872906995806659 0.7241919226481899 -0.033391629695388544 0.04541533339438254 world right_camera"/>

  <!-- ===================== -->
  <!-- RIGHT camera: v4l2 + rectification -->
  <!-- ===================== -->
  <node pkg="v4l2_camera" exec="v4l2_camera_node" name="right_cam_driver" output="screen">
    <param name="video_device" value="/dev/video0"/>
    <param name="image_size" value="[1280,720]"/>
    <param name="pixel_format" value="YUYV"/>
    <param name="frame_rate" value="30.0"/>
    <param name="camera_info_url" value="file:///home/$(env USER)/camera/right/ost.yaml"/>
    <!-- remap raw outputs into /stereo/right/* -->
    <remap from="image_raw"   to="/stereo/right/image_raw"/>
    <remap from="camera_info" to="/stereo/right/camera_info"/>
  </node>

  <node pkg="image_proc" exec="image_proc" name="right_rectify" output="screen">
    <remap from="image"        to="/stereo/right/image_raw"/>
    <remap from="camera_info"  to="/stereo/right/camera_info"/>
    <remap from="image_rect"   to="/stereo/right/image_rect"/>
  </node>

  <!-- ===================== -->
  <!-- LEFT camera: v4l2 + rectification -->
  <!-- ===================== -->
  <node pkg="v4l2_camera" exec="v4l2_camera_node" name="left_cam_driver" output="screen">
    <param name="video_device" value="/dev/video2"/>
    <param name="image_size" value="[1280,720]"/>
    <param name="pixel_format" value="YUYV"/>
    <param name="frame_rate" value="30.0"/>
    <param name="camera_info_url" value="file:///home/$(env USER)/camera/left/ost.yaml"/>
    <!-- remap raw outputs into /stereo/left/* -->
    <remap from="image_raw"   to="/stereo/left/image_raw"/>
    <remap from="camera_info" to="/stereo/left/camera_info"/>
  </node>

  <node pkg="image_proc" exec="image_proc" name="left_rectify" output="screen">
    <remap from="image"        to="/stereo/left/image_raw"/>
    <remap from="camera_info"  to="/stereo/left/camera_info"/>
    <remap from="image_rect"   to="/stereo/left/image_rect"/>
  </node>

  <!-- Object detector with inside-node two-camera fusion + 3D triangulation -->
  <!-- NOTE: exec updated to 'object_detector' to match your renamed node -->
  <node pkg="object_detection" exec="object_detector" name="object_detector" output="screen">
    <!-- Frames -->
    <param name="world_frame" value="world"/>
    <param name="left_cam_frame" value="left_camera"/>
    <param name="right_cam_frame" value="right_camera"/>

    <!-- Subscribe to rectified images -->
    <param name="left_image"  value="/stereo/left/image_rect"/>
    <param name="right_image" value="/stereo/right/image_rect"/>
    <!-- CameraInfo stays the same topics -->
    <param name="left_info"   value="/stereo/left/camera_info"/>
    <param name="right_info"  value="/stereo/right/camera_info"/>

    <!-- Prefer constellation association by default (robust to bad right intrinsics) -->
    <param name="assoc_mode" value="constellation"/>
    <param name="assoc_pixel_gate" value="30.0"/>
    <param name="symmetric_match" value="true"/>

    <!-- Weâ€™re using rectified images, so no undistort is necessary for matching -->
    <param name="use_undistort_assoc" value="false"/>

    <!-- Plane & triangulation -->
    <param name="use_general_plane" value="false"/>
    <param name="plane_n" value="[0.0, 0.0, 1.0]"/>
    <param name="plane_d" value="0.0"/>
    <param name="triangulate_3d" value="true"/>
    <param name="min_ray_angle_deg" value="1.0"/>

    <!-- Detection tweaks you can adjust -->
    <param name="blur_ksize" value="7"/>
    <param name="morph_open" value="1"/>
    <param name="morph_close" value="5"/>
    <param name="min_area" value="1200.0"/>
    <param name="min_rectangularity" value="0.7"/>
    <param name="min_solidity" value="0.8"/>
    <param name="use_adaptive" value="false"/>
    <param name="global_thresh" value="90"/>

      <!-- New / tuned params -->
    <param name="publish_unpaired" value="false"/>
    <param name="assoc_plane_gate_m" value="0.35"/>          <!-- looser gate for noisy cal -->
    <param name="assoc_symmetric" value="false"/>
    <param name="triangulate_3d" value="true"/>
    <param name="min_ray_angle_deg" value="1.0"/>
    <param name="max_triang_gap_m" value="0.20"/>            <!-- allow bigger gap before fallback -->
    <!-- plane_n / plane_d already default to z=0 -->

    <param name="intrinsics_source" value="P"/>
  </node>
</launch>